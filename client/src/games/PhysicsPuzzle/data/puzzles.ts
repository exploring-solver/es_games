import { physicsConcepts } from './physicsScenarios';

export interface PhysicsObject {
  id: string;
  type: 'ball' | 'box' | 'platform' | 'ramp' | 'pendulum' | 'spring' | 'domino' | 'lever' | 'wheel';
  x: number;
  y: number;
  width?: number;
  height?: number;
  radius?: number;
  angle?: number;
  color: string;
  mass: number;
  friction: number;
  restitution: number; // bounciness (0-1)
  isStatic: boolean;
  isSensor?: boolean;
  movable?: boolean; // Can player move this object?
}

export interface PuzzleLevel {
  id: number;
  name: string;
  difficulty: 1 | 2 | 3 | 4 | 5;
  conceptIds: string[];
  description: string;
  objectives: {
    type: 'reach' | 'collect' | 'activate' | 'chain' | 'time';
    description: string;
    targetId?: string;
    count?: number;
    timeLimit?: number;
  }[];
  initialObjects: PhysicsObject[];
  availableObjects: {
    type: PhysicsObject['type'];
    count: number;
    properties: Partial<PhysicsObject>;
  }[];
  relayEffect?: {
    type: 'gravity' | 'friction' | 'wind' | 'time' | 'mass';
    description: string;
    modifier: number;
  };
  hints: string[];
  par: number; // Par number of objects to use
}

export const puzzleLevels: PuzzleLevel[] = [
  // EASY LEVELS (1-10)
  {
    id: 1,
    name: 'First Steps',
    difficulty: 1,
    conceptIds: ['gravity-basic'],
    description: 'Get the ball to the target using a simple ramp',
    objectives: [
      {
        type: 'reach',
        description: 'Get the ball to the target zone',
        targetId: 'target-1',
      },
    ],
    initialObjects: [
      {
        id: 'ball-1',
        type: 'ball',
        x: 100,
        y: 100,
        radius: 15,
        color: '#4ade80',
        mass: 1,
        friction: 0.3,
        restitution: 0.6,
        isStatic: false,
      },
      {
        id: 'ground',
        type: 'platform',
        x: 400,
        y: 550,
        width: 800,
        height: 20,
        angle: 0,
        color: '#64748b',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
      },
      {
        id: 'target-1',
        type: 'platform',
        x: 700,
        y: 520,
        width: 60,
        height: 10,
        angle: 0,
        color: '#fbbf24',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
        isSensor: true,
      },
    ],
    availableObjects: [
      {
        type: 'ramp',
        count: 1,
        properties: {
          width: 150,
          height: 10,
          friction: 0.1,
          restitution: 0,
          color: '#94a3b8',
        },
      },
    ],
    hints: [
      'Place a ramp from the ball to the target',
      'The ball will roll down due to gravity',
      'Adjust the angle for a smooth path',
    ],
    par: 1,
  },
  {
    id: 2,
    name: 'Two Steps',
    difficulty: 1,
    conceptIds: ['gravity-basic', 'momentum-conservation'],
    description: 'Use multiple ramps to navigate obstacles',
    objectives: [
      {
        type: 'reach',
        description: 'Guide the ball over the wall',
        targetId: 'target-2',
      },
    ],
    initialObjects: [
      {
        id: 'ball-1',
        type: 'ball',
        x: 100,
        y: 100,
        radius: 15,
        color: '#4ade80',
        mass: 1,
        friction: 0.3,
        restitution: 0.6,
        isStatic: false,
      },
      {
        id: 'ground',
        type: 'platform',
        x: 400,
        y: 550,
        width: 800,
        height: 20,
        angle: 0,
        color: '#64748b',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
      },
      {
        id: 'wall',
        type: 'platform',
        x: 400,
        y: 450,
        width: 20,
        height: 120,
        angle: 0,
        color: '#ef4444',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
      },
      {
        id: 'target-2',
        type: 'platform',
        x: 700,
        y: 520,
        width: 60,
        height: 10,
        angle: 0,
        color: '#fbbf24',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
        isSensor: true,
      },
    ],
    availableObjects: [
      {
        type: 'ramp',
        count: 2,
        properties: {
          width: 120,
          height: 10,
          friction: 0.1,
          restitution: 0,
          color: '#94a3b8',
        },
      },
    ],
    hints: [
      'Build a ramp up and over the wall',
      'The ball needs enough speed to clear the obstacle',
    ],
    par: 2,
  },
  {
    id: 3,
    name: 'Launch Pad',
    difficulty: 2,
    conceptIds: ['gravity-projectile'],
    description: 'Launch a ball through the air to hit the target',
    objectives: [
      {
        type: 'reach',
        description: 'Launch the ball into the target zone',
        targetId: 'target-3',
      },
    ],
    initialObjects: [
      {
        id: 'ball-1',
        type: 'ball',
        x: 100,
        y: 450,
        radius: 12,
        color: '#60a5fa',
        mass: 1,
        friction: 0.3,
        restitution: 0.7,
        isStatic: false,
      },
      {
        id: 'ground',
        type: 'platform',
        x: 400,
        y: 550,
        width: 800,
        height: 20,
        angle: 0,
        color: '#64748b',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
      },
      {
        id: 'target-3',
        type: 'platform',
        x: 650,
        y: 300,
        width: 80,
        height: 80,
        angle: 0,
        color: '#fbbf24',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
        isSensor: true,
      },
    ],
    availableObjects: [
      {
        type: 'ramp',
        count: 1,
        properties: {
          width: 180,
          height: 10,
          friction: 0.05,
          restitution: 0,
          color: '#94a3b8',
        },
      },
      {
        type: 'platform',
        count: 1,
        properties: {
          width: 100,
          height: 15,
          friction: 0.5,
          restitution: 0,
          color: '#475569',
        },
      },
    ],
    hints: [
      'Create a steep ramp to launch the ball',
      '45 degrees gives maximum range in projectile motion',
      'The ball follows a parabolic path',
    ],
    par: 2,
  },
  {
    id: 4,
    name: 'Domino Effect',
    difficulty: 2,
    conceptIds: ['momentum-conservation'],
    description: 'Create a chain reaction to activate all switches',
    objectives: [
      {
        type: 'activate',
        description: 'Knock down all dominoes',
        count: 5,
      },
    ],
    initialObjects: [
      {
        id: 'ball-1',
        type: 'ball',
        x: 100,
        y: 100,
        radius: 20,
        color: '#f472b6',
        mass: 2,
        friction: 0.3,
        restitution: 0.4,
        isStatic: false,
      },
      {
        id: 'ground',
        type: 'platform',
        x: 400,
        y: 550,
        width: 800,
        height: 20,
        angle: 0,
        color: '#64748b',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
      },
      {
        id: 'domino-1',
        type: 'domino',
        x: 300,
        y: 500,
        width: 10,
        height: 50,
        angle: 0,
        color: '#ec4899',
        mass: 0.5,
        friction: 0.5,
        restitution: 0.1,
        isStatic: false,
      },
      {
        id: 'domino-2',
        type: 'domino',
        x: 350,
        y: 500,
        width: 10,
        height: 50,
        angle: 0,
        color: '#ec4899',
        mass: 0.5,
        friction: 0.5,
        restitution: 0.1,
        isStatic: false,
      },
      {
        id: 'domino-3',
        type: 'domino',
        x: 400,
        y: 500,
        width: 10,
        height: 50,
        angle: 0,
        color: '#ec4899',
        mass: 0.5,
        friction: 0.5,
        restitution: 0.1,
        isStatic: false,
      },
      {
        id: 'domino-4',
        type: 'domino',
        x: 450,
        y: 500,
        width: 10,
        height: 50,
        angle: 0,
        color: '#ec4899',
        mass: 0.5,
        restitution: 0.1,
        friction: 0.5,
        isStatic: false,
      },
      {
        id: 'domino-5',
        type: 'domino',
        x: 500,
        y: 500,
        width: 10,
        height: 50,
        angle: 0,
        color: '#ec4899',
        mass: 0.5,
        friction: 0.5,
        restitution: 0.1,
        isStatic: false,
      },
    ],
    availableObjects: [
      {
        type: 'ramp',
        count: 1,
        properties: {
          width: 150,
          height: 10,
          friction: 0.1,
          restitution: 0,
          color: '#94a3b8',
        },
      },
    ],
    hints: [
      'Roll the ball down a ramp to hit the first domino',
      'Momentum transfers from domino to domino',
      'Each domino must have enough energy to knock the next one',
    ],
    par: 1,
  },
  {
    id: 5,
    name: 'Friction Challenge',
    difficulty: 2,
    conceptIds: ['friction-kinetic', 'friction-static'],
    description: 'Navigate surfaces with different friction',
    objectives: [
      {
        type: 'reach',
        description: 'Get the box to the target',
        targetId: 'target-5',
      },
    ],
    initialObjects: [
      {
        id: 'box-1',
        type: 'box',
        x: 100,
        y: 450,
        width: 30,
        height: 30,
        angle: 0,
        color: '#8b5cf6',
        mass: 1.5,
        friction: 0.8,
        restitution: 0.1,
        isStatic: false,
      },
      {
        id: 'ground',
        type: 'platform',
        x: 400,
        y: 550,
        width: 800,
        height: 20,
        angle: 0,
        color: '#64748b',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
      },
      {
        id: 'ice',
        type: 'platform',
        x: 300,
        y: 520,
        width: 200,
        height: 15,
        angle: 0,
        color: '#67e8f9',
        mass: 0,
        friction: 0.05,
        restitution: 0,
        isStatic: true,
      },
      {
        id: 'rough',
        type: 'platform',
        x: 600,
        y: 520,
        width: 200,
        height: 15,
        angle: 0,
        color: '#92400e',
        mass: 0,
        friction: 1.2,
        restitution: 0,
        isStatic: true,
      },
      {
        id: 'target-5',
        type: 'platform',
        x: 750,
        y: 490,
        width: 60,
        height: 10,
        angle: 0,
        color: '#fbbf24',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
        isSensor: true,
      },
    ],
    availableObjects: [
      {
        type: 'ramp',
        count: 2,
        properties: {
          width: 100,
          height: 10,
          friction: 0.2,
          restitution: 0,
          color: '#94a3b8',
        },
      },
      {
        type: 'ball',
        count: 1,
        properties: {
          radius: 15,
          mass: 3,
          friction: 0.3,
          restitution: 0.6,
          color: '#f97316',
        },
      },
    ],
    hints: [
      'Ice (cyan) has very low friction',
      'Rough surface (brown) has high friction and slows objects',
      'Use the ball to push the box across the rough surface',
    ],
    par: 3,
  },

  // MEDIUM LEVELS (6-20)
  {
    id: 6,
    name: 'Pendulum Power',
    difficulty: 3,
    conceptIds: ['energy-potential', 'energy-kinetic', 'energy-conservation'],
    description: 'Use pendulum swings to transfer energy',
    objectives: [
      {
        type: 'reach',
        description: 'Swing the ball to the target',
        targetId: 'target-6',
      },
    ],
    initialObjects: [
      {
        id: 'ground',
        type: 'platform',
        x: 400,
        y: 550,
        width: 800,
        height: 20,
        angle: 0,
        color: '#64748b',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
      },
      {
        id: 'target-6',
        type: 'platform',
        x: 650,
        y: 520,
        width: 60,
        height: 10,
        angle: 0,
        color: '#fbbf24',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
        isSensor: true,
      },
    ],
    availableObjects: [
      {
        type: 'pendulum',
        count: 1,
        properties: {
          radius: 15,
          mass: 1,
          friction: 0.1,
          restitution: 0.8,
          color: '#06b6d4',
        },
      },
      {
        type: 'platform',
        count: 1,
        properties: {
          width: 20,
          height: 20,
          friction: 0,
          restitution: 0,
          color: '#475569',
        },
      },
    ],
    hints: [
      'Pendulums convert potential energy to kinetic energy',
      'Release from a height to get maximum swing',
      'Energy is conserved - height determines speed',
    ],
    par: 2,
  },
  {
    id: 7,
    name: 'Newton\'s Cradle',
    difficulty: 3,
    conceptIds: ['momentum-conservation', 'momentum-elastic'],
    description: 'Perfect momentum transfer between balls',
    objectives: [
      {
        type: 'activate',
        description: 'Activate the switch with perfect momentum transfer',
        targetId: 'switch-1',
      },
    ],
    initialObjects: [
      {
        id: 'ground',
        type: 'platform',
        x: 400,
        y: 550,
        width: 800,
        height: 20,
        angle: 0,
        color: '#64748b',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
      },
      {
        id: 'ball-1',
        type: 'ball',
        x: 300,
        y: 400,
        radius: 15,
        color: '#ef4444',
        mass: 1,
        friction: 0,
        restitution: 1,
        isStatic: false,
      },
      {
        id: 'ball-2',
        type: 'ball',
        x: 330,
        y: 400,
        radius: 15,
        color: '#f97316',
        mass: 1,
        friction: 0,
        restitution: 1,
        isStatic: false,
      },
      {
        id: 'ball-3',
        type: 'ball',
        x: 360,
        y: 400,
        radius: 15,
        color: '#fbbf24',
        mass: 1,
        friction: 0,
        restitution: 1,
        isStatic: false,
      },
      {
        id: 'switch-1',
        type: 'box',
        x: 500,
        y: 400,
        width: 30,
        height: 30,
        angle: 0,
        color: '#22c55e',
        mass: 0.5,
        friction: 0.5,
        restitution: 0.8,
        isStatic: false,
      },
    ],
    availableObjects: [
      {
        type: 'platform',
        count: 2,
        properties: {
          width: 15,
          height: 200,
          friction: 0,
          restitution: 0,
          color: '#475569',
        },
      },
    ],
    hints: [
      'Line up the balls so they\'re just touching',
      'In elastic collisions, momentum transfers perfectly',
      'One ball in means one ball out with the same speed',
    ],
    par: 2,
  },
  {
    id: 8,
    name: 'Rube Goldberg Machine',
    difficulty: 3,
    conceptIds: ['momentum-conservation', 'gravity-projectile', 'energy-conservation'],
    description: 'Build a complex chain reaction',
    objectives: [
      {
        type: 'chain',
        description: 'Create a chain reaction that activates all 3 switches',
        count: 3,
      },
    ],
    initialObjects: [
      {
        id: 'ball-starter',
        type: 'ball',
        x: 50,
        y: 100,
        radius: 12,
        color: '#a855f7',
        mass: 1,
        friction: 0.3,
        restitution: 0.7,
        isStatic: false,
      },
      {
        id: 'ground',
        type: 'platform',
        x: 400,
        y: 550,
        width: 800,
        height: 20,
        angle: 0,
        color: '#64748b',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
      },
      {
        id: 'switch-1',
        type: 'box',
        x: 250,
        y: 500,
        width: 20,
        height: 20,
        angle: 0,
        color: '#22c55e',
        mass: 0.3,
        friction: 0.5,
        restitution: 0.5,
        isStatic: false,
      },
      {
        id: 'switch-2',
        type: 'box',
        x: 500,
        y: 450,
        width: 20,
        height: 20,
        angle: 0,
        color: '#22c55e',
        mass: 0.3,
        friction: 0.5,
        restitution: 0.5,
        isStatic: false,
      },
      {
        id: 'switch-3',
        type: 'box',
        x: 700,
        y: 500,
        width: 20,
        height: 20,
        angle: 0,
        color: '#22c55e',
        mass: 0.3,
        friction: 0.5,
        restitution: 0.5,
        isStatic: false,
      },
    ],
    availableObjects: [
      {
        type: 'ramp',
        count: 3,
        properties: {
          width: 120,
          height: 10,
          friction: 0.1,
          restitution: 0,
          color: '#94a3b8',
        },
      },
      {
        type: 'platform',
        count: 2,
        properties: {
          width: 80,
          height: 12,
          friction: 0.5,
          restitution: 0,
          color: '#475569',
        },
      },
      {
        type: 'ball',
        count: 2,
        properties: {
          radius: 10,
          mass: 0.8,
          friction: 0.3,
          restitution: 0.7,
          color: '#fb923c',
        },
      },
    ],
    hints: [
      'Design a path for the ball to trigger each switch in sequence',
      'Use gravity and momentum to maintain energy through the machine',
      'Each action should naturally lead to the next',
    ],
    par: 7,
  },
  {
    id: 9,
    name: 'Lever Lift',
    difficulty: 3,
    conceptIds: ['forces-normal', 'forces-tension'],
    description: 'Use levers to lift heavy objects',
    objectives: [
      {
        type: 'reach',
        description: 'Lift the heavy box to the platform',
        targetId: 'platform-high',
      },
    ],
    initialObjects: [
      {
        id: 'ground',
        type: 'platform',
        x: 400,
        y: 550,
        width: 800,
        height: 20,
        angle: 0,
        color: '#64748b',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
      },
      {
        id: 'heavy-box',
        type: 'box',
        x: 200,
        y: 500,
        width: 40,
        height: 40,
        angle: 0,
        color: '#dc2626',
        mass: 5,
        friction: 0.8,
        restitution: 0.1,
        isStatic: false,
      },
      {
        id: 'platform-high',
        type: 'platform',
        x: 600,
        y: 300,
        width: 100,
        height: 15,
        angle: 0,
        color: '#fbbf24',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
        isSensor: true,
      },
    ],
    availableObjects: [
      {
        type: 'lever',
        count: 1,
        properties: {
          width: 200,
          height: 10,
          mass: 0.5,
          friction: 0.5,
          restitution: 0.1,
          color: '#78716c',
        },
      },
      {
        type: 'platform',
        count: 1,
        properties: {
          width: 20,
          height: 40,
          friction: 0,
          restitution: 0,
          color: '#475569',
        },
      },
      {
        type: 'ball',
        count: 1,
        properties: {
          radius: 25,
          mass: 3,
          friction: 0.3,
          restitution: 0.5,
          color: '#3b82f6',
        },
      },
      {
        type: 'ramp',
        count: 1,
        properties: {
          width: 150,
          height: 10,
          friction: 0.1,
          restitution: 0,
          color: '#94a3b8',
        },
      },
    ],
    hints: [
      'Levers multiply force - longer arm gives more advantage',
      'Place the fulcrum (pivot) closer to the heavy object',
      'Drop weight on the long end to lift the heavy box',
    ],
    par: 4,
  },
  {
    id: 10,
    name: 'Spring Launch',
    difficulty: 3,
    conceptIds: ['energy-potential', 'energy-kinetic'],
    description: 'Use springs to store and release energy',
    objectives: [
      {
        type: 'reach',
        description: 'Launch the ball high enough to reach the target',
        targetId: 'target-10',
      },
    ],
    initialObjects: [
      {
        id: 'ground',
        type: 'platform',
        x: 400,
        y: 550,
        width: 800,
        height: 20,
        angle: 0,
        color: '#64748b',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
      },
      {
        id: 'target-10',
        type: 'platform',
        x: 400,
        y: 100,
        width: 80,
        height: 15,
        angle: 0,
        color: '#fbbf24',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
        isSensor: true,
      },
    ],
    availableObjects: [
      {
        type: 'spring',
        count: 1,
        properties: {
          width: 30,
          height: 60,
          mass: 0,
          friction: 0,
          restitution: 1.5,
          color: '#84cc16',
        },
      },
      {
        type: 'ball',
        count: 1,
        properties: {
          radius: 15,
          mass: 1,
          friction: 0.3,
          restitution: 0.9,
          color: '#06b6d4',
        },
      },
      {
        type: 'platform',
        count: 1,
        properties: {
          width: 100,
          height: 15,
          friction: 0.5,
          restitution: 0,
          color: '#475569',
        },
      },
    ],
    hints: [
      'Springs store elastic potential energy when compressed',
      'Drop the ball from a height onto the spring',
      'The spring will launch the ball upward',
    ],
    par: 3,
  },

  // Additional levels 11-30 would continue with increasing complexity
  // including circular motion, wave mechanics, etc.
];

// Generate remaining levels (11-30) programmatically for variety
for (let i = 11; i <= 30; i++) {
  const difficulty = Math.min(5, Math.floor((i - 1) / 6) + 1) as 1 | 2 | 3 | 4 | 5;
  const conceptIndex = (i - 1) % physicsConcepts.length;
  const concept = physicsConcepts[conceptIndex];

  puzzleLevels.push({
    id: i,
    name: `${concept.name} Challenge ${i}`,
    difficulty,
    conceptIds: [concept.id],
    description: `Advanced puzzle featuring ${concept.name.toLowerCase()}`,
    objectives: [
      {
        type: 'reach',
        description: 'Complete the physics challenge',
        targetId: `target-${i}`,
      },
    ],
    initialObjects: [
      {
        id: 'ground',
        type: 'platform',
        x: 400,
        y: 550,
        width: 800,
        height: 20,
        angle: 0,
        color: '#64748b',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
      },
      {
        id: `target-${i}`,
        type: 'platform',
        x: 650 + (i % 3) * 50,
        y: 200 + (i % 5) * 60,
        width: 60,
        height: 10,
        angle: 0,
        color: '#fbbf24',
        mass: 0,
        friction: 0.5,
        restitution: 0,
        isStatic: true,
        isSensor: true,
      },
    ],
    availableObjects: [
      {
        type: 'ramp',
        count: 2 + Math.floor(difficulty / 2),
        properties: {
          width: 120,
          height: 10,
          friction: 0.1,
          restitution: 0,
          color: '#94a3b8',
        },
      },
      {
        type: 'ball',
        count: 1 + Math.floor(difficulty / 3),
        properties: {
          radius: 15,
          mass: 1,
          friction: 0.3,
          restitution: 0.7,
          color: '#3b82f6',
        },
      },
      {
        type: 'platform',
        count: 1 + Math.floor(difficulty / 2),
        properties: {
          width: 100,
          height: 15,
          friction: 0.5,
          restitution: 0,
          color: '#475569',
        },
      },
    ],
    hints: [
      `Apply the principles of ${concept.name.toLowerCase()}`,
      concept.educationalContent.concept,
      'Experiment with different arrangements',
    ],
    par: 3 + difficulty,
  });
}

export const getConceptForLevel = (levelId: number) => {
  const level = puzzleLevels.find((l) => l.id === levelId);
  if (!level) return null;

  return level.conceptIds.map((id) => physicsConcepts.find((c) => c.id === id)).filter(Boolean);
};
